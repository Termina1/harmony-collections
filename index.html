<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Harmony Collections Shim by Benvie</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/main.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>

      <header>
        <h1>Harmony Collections Shim</h1>
        <p>Map, WeakMap, and Set implemented in JavaScript</p>
      </header>

      <div id="banner">
        <span id="logo"></span>

        <a href="https://github.com/Benvie/harmony-collections" class="button fork"><strong>View On GitHub</strong></a>
        <div class="downloads">
          <span>Downloads:</span>
          <ul>
            <li><a href="https://github.com/Benvie/harmony-collections/zipball/master" class="button">ZIP</a></li>
            <li><a href="https://github.com/Benvie/harmony-collections/tarball/master" class="button">TAR</a></li>
          </ul>
        </div>
      </div><!-- end banner -->

    <div class="wrapper">
      <nav>
        <ul></ul>
      </nav>
      <section>
        <h1>Harmony Collections Shim</h1>

<p>Use the new <strong>Map</strong>, <strong>Set</strong>, and <strong>WeakMap</strong> from the upcoming ES6 standard right now! This shim provides full functionality for these collections and delivers the benefits of using them.</p>

<h2>Compatability</h2>

<p>Works with IE9+, Chrome, Firefox, Safari, untested in Opera. <strong>IE8 support has been recently added but is experimental.</strong></p>

<h2>Install/Use</h2>

<p>If using node, install via:</p>

<pre><code>npm install harmony-collections
</code></pre>

<p>In the browser, include <strong>harmony-collection.js</strong> or <strong>harmony-collections.min.js</strong> and Map, WeakMap, Set, and HashMap will be exposed on the window. (you can also define <code>window.exports</code> which will cause them to end up there).</p>

<h2>Overview</h2>

<p>ES6 Collections provide a new core weapon to your JS arsenal: objects as keys. This allows you to do the following awesome things: store private data "on" public objects, private properties, secretly "tag" objects, namespace properties, access controlled properties, check object uniqueness in <code>O(1)</code> time complexity.</p>

<h3>WeakMap Garbage Collection Semantics</h3>

<p>The benefit of using WeakMaps is enhanced garbage collection. In a WeakMap, the only reference created is key -&gt; value, so it's possible for a key/value in a WeakMap to be garbage collected while the WeakMap they're in still exists! Compare this to an Array, where all items in the Array will not be garbage collected as long as the Array isn't. This forces either explicitly management of the object lifespans, or more commonly is simply a memory leak.</p>

<p>For example, data stored using jQuery.data can never be garbage collected unless explicitly nulled out, because it is stored in a container that strongly references it. Using a WeakMap, it's possible to associate data with an element and have the data destroyed when the element is without memory leaking the element, i.e. <code>weakmap.set(element, { myData: 'gc safe!' })</code>. jQuery.data (every library has similar functionality) prevent the element from memory leaking by using a numeric id, but this does nothing for the <strong>data</strong> that is stored.</p>

<h2>Detailed Examples</h2>

<h3>Map/WeakMap</h3>

<p>Retire jQuery.data and similar, consider it replaced with prejudice.</p>

<div class="highlight"><pre><span class="c1">// reusable storage creator</span>
<span class="kd">function</span> <span class="nx">createStorage</span><span class="p">(){</span>
  <span class="kd">var</span> <span class="nx">store</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WeakMap</span><span class="p">;</span>
  <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">v</span> <span class="o">=</span> <span class="nx">store</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">o</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">v</span><span class="p">)</span> <span class="nx">store</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">v</span> <span class="o">=</span> <span class="p">{});</span>
    <span class="k">return</span> <span class="nx">v</span><span class="p">;</span>
  <span class="p">};</span>
<span class="p">}</span>

<span class="c1">// allows private/namespaced properties for the objects</span>
<span class="kd">var</span> <span class="nx">_</span> <span class="o">=</span> <span class="nx">createStorage</span><span class="p">();</span>

<span class="nx">functioon</span> <span class="nx">Wrapper</span><span class="p">(</span><span class="nx">element</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">_element</span> <span class="o">=</span> <span class="nx">_</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">_element</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">_element</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">;</span>

  <span class="nx">_element</span><span class="p">.</span><span class="nx">wrapper</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="nx">_</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">element</span> <span class="o">=</span> <span class="nx">element</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">Wrapper</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">get</span> <span class="nx">classes</span><span class="p">(){</span>
    <span class="k">return</span> <span class="p">[].</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">_</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">element</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">set</span> <span class="nx">classes</span><span class="p">(</span><span class="nx">v</span><span class="p">){</span>
    <span class="nx">_</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">element</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="p">[].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">v</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">' '</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>
</pre></div>

<h3>Set</h3>

<p>A Set is similar to an Array in what it stores, but different in how. A Set is unordered and its values are unique. Determining whether an item is in a Set is <code>O(1)</code> but <code>O(n)</code> for an Array. An example of where this is useful is in implementing <code>Array.prototype.unique</code>.</p>

<p>Both of the following will output the same result, however the Set version is <code>O(n)</code> and the one using indexOf is <code>O(n^2)</code>. For an array taking 30 seconds using the set, an <strong><em>hour</em></strong> is required for indexOf.</p>

<div class="highlight"><pre><span class="kd">function</span> <span class="nx">uniqueUsingIndexOf</span><span class="p">(</span><span class="nx">array</span><span class="p">){</span>
  <span class="k">return</span> <span class="nx">array</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">index</span><span class="p">){</span>
    <span class="k">return</span> <span class="nx">array</span><span class="p">.</span><span class="nx">lastIndexOf</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">index</span><span class="p">;</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">uniqueUsingSet</span><span class="p">(</span><span class="nx">array</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">seen</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Set</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">array</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">seen</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">item</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">seen</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span>
</pre></div>

<h2>API Reference</h2>

<h3>WeakMap</h3>

<p><strong>Non-primitives</strong> are valid keys. Objects, functions, DOM nodes, etc.</p>

<p>WeakMaps require the use of objects as keys; primitives are not valid keys. WeakMaps have no way to enumerate their keys or values. Because of this, the only way to retrieve a value from a WeakMap is to have access to both the WeakMap itself as well as the object used as the key.</p>

<ul>
<li>
<code>new WeakMap()</code> Create a new WeakMap.</li>
<li>
<code>WeakMap#set(key, value)</code> Key is any value including objects. Only non-primitives can be used as keys. Returns undefined.</li>
<li>
<code>WeakMap#get(key)</code> Returns the value that key corresponds to the key or undefined.</li>
<li>
<code>WeakMap#has(key)</code> Returns boolean.</li>
<li>
<code>WeakMap#delete(key)</code> Removes value from the collection if found. Returns true.</li>
</ul><h3>HashMap</h3>

<p><strong>Primitives</strong> are valid keys. Exact value is used, so <code>500</code> is different from <code>"500"</code>, <code>-0</code> is different from <code>0</code>, `<code>"false"</code> isn't <code>false</code>, etc. NaN does equal itself when used as a key (as opposed to everywhere else in JS).</p>

<p>Though not part of ES6, HashMap is also exported. This has the same API as a Map except it only accepts primitive keys. This is needed to implement Map so as a bonus it's exported as well.</p>

<ul>
<li>
<code>new HashMap(iterable)</code> Create a new HashMap populated with the iterable. Accepts <strong>[[Key, Value]..], Array, Object, Collection</strong>.</li>
<li>
<code>HashMap#set(key, value)</code> Key must be primitive. Returns undefined.</li>
<li>
<code>HashMap#get(key)</code> Returns the value that key corresponds to or undefined.</li>
<li>
<code>HashMap#has(key)</code> Returns boolean.</li>
<li>
<code>HashMap#delete(key)</code> Removes value from the collection if found. Returns true.</li>
<li>
<code>HashMap#size()</code> Returns the number of items in the collection.</li>
<li>
<code>HashMap#forEach(callback, context)</code> Loop through the collection raising callback for each.</li>
</ul><h3>Map</h3>

<p><strong>All possible values</strong> are valid keys, including -0, undefined, null, and NaN. Uses a HashMap and WeakMap together to cover primitives and non-primitives.</p>

<p>Maps are much the same as WeakMaps but they can be iterated and thus their contents can be inspected. Many use cases have no requirement for anonymity or special garbage collection, but can benefit from using objects as keys and also not having the storage contained in the Map itself.</p>

<ul>
<li>
<code>new Map(iterable)</code> Create a new Map populated with the iterable. Accepts <strong>[[Key, Value]..], Array, Object, Collection</strong>.</li>
<li>
<code>Map#set(key, value)</code> Key is any value including objects. Returns undefined.</li>
<li>
<code>Map#get(key)</code> Returns the value that key corresponds to or undefined.</li>
<li>
<code>Map#has(key)</code> Returns boolean.</li>
<li>
<code>Map#delete(key)</code> Removes value from the collection if found. Returns true.</li>
<li>
<code>Map#size()</code> Returns the number of items in the collection.</li>
<li>
<code>Map#forEach(callback, context)</code> Loop through the collection raising callback for each.</li>
</ul><h3>Set</h3>

<p>Sets are similar to arrays but enforce uniqueness of values and are unordered. Adding the same value twice will only result in one being added to the set.</p>

<ul>
<li>
<code>new Set(iterable)</code> Create a new Set populated with the iterable. Accepts <strong>Array, Object, Collection</strong>.</li>
<li>
<code>Set#add(value)</code> Inserts a value of any type into the set if it's not already in the set.</li>
<li>
<code>Set#has(value)</code> Returns boolean.</li>
<li>
<code>Set#delete(value)</code> Removes value from the collection if found. Returns true.</li>
<li>
<code>Set#size()</code> Returns the number of items in the collection.</li>
<li>
<code>Set#forEach(callback, context)</code> Loop through the collection raising callback for each.</li>
</ul><h2>License</h2>

<p>(The MIT License)
Copyright (c) 2012 Brandon Benvie <a href="http://bbenvie.com">http://bbenvie.com</a></p>

<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files
(the 'Software'), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge,
publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so,
subject to the following conditions:</p>

<p>The above copyright notice and this permission notice shall be included with all copies or substantial portions of the Software.</p>

<p>THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE
FOR ANY  CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH
THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>
      </section>
      <footer>
        <p>Project maintained by <a href="https://github.com/Benvie">Benvie</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="http://twitter.com/#!/michigangraham">mattgraham</a></small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>