!function(exports,global,undefined){"use strict";function isObject(o){return o!=null&&typeof o=="object"||typeof o=="function"}function isPrimitive(o){return o==null||typeof o!="object"&&typeof o!="function"}var Fproto=Function.prototype,callbind=Fproto.bind.bind(Fproto.call),hasOwn=callbind(Object.prototype.hasOwnProperty),keystore=Object.create.bind(null,null),cryoDesc={writable:!0,value:undefined};function cryostore(o){o=Object(o);var props=Array.isArray(o)?o:Object.keys(o);return Object.preventExtensions(Object.create(null,props.reduce(function(ret,name){return ret[name]=name in o?{value:o[name],writable:!0}:cryoDesc,ret},{})))}var UID=function(){var keys=keystore();return function UID(){var key="$"+(Math.random()/1.1).toString(36).slice(2);return key in keys?UID():keys[key]=key}}();Fproto.name||!function(){var toCode=callbind(Fproto.toString);Object.defineProperty(Fproto,"name",{configurable:!0,get:function(){if(this===Fproto)return"Empty";var src=toCode(this);return src=src.slice(9,src.indexOf("(")),Object.defineProperty(this,"name",{value:src}),src}})}();var Locker=function(){var perObjectStorage=function(){var lockerSrc='"use strict"; return function(k){ if (k === h) return l; }',getProps=Object.getOwnPropertyNames,globalUID=UID();return Object.defineProperty(Object,"getOwnPropertyNames",{configurable:!0,writable:!0,value:function getOwnPropertyNames(obj){var props=getProps(obj);return hasOwn(obj,globalUID)&&props.splice(props.indexOf(globalUID),1),props}}),function perObjectStorage(obj){if(hasOwn(obj,globalUID))return obj[globalUID];var store=keystore();if(!Object.isExtensible(obj))throw Error("Storage for non-extensible objects not implemented yet");return Object.defineProperty(obj,globalUID,{value:store}),store}}();function Locker(name){var privateUID=UID(),hashkey=keystore();this.name=name,this.unlocker=function unlocker(obj){var storage=perObjectStorage(obj);if(hasOwn(storage,privateUID))return storage[privateUID](hashkey);var lockbox=Object.preventExtensions(Object.create(null,{value:{writable:!0,value:undefined}}));return Object.defineProperty(storage,privateUID,{configurable:!0,value:Function("h","l",lockerSrc)(hashkey,lockbox)}),lockbox}}return Locker.prototype={get:function get(obj){return this.unlocker(obj).value},set:function set(obj,value){return this.unlocker(obj).value=value},wrapper:function wrapper(){var self=this;return function wrap(obj,value){self.unlocker(obj).value=value}},unwrapper:function unwrapper(){var self=this;return function unwrap(obj){var value=self.unlocker(obj).value;if(!value)throw new TypeError(self.name+" is not generic.");return value}}},Locker}();!function(){function Pair(key,value){this.key=key,this.value=value}Pair.prototype.valueOf=function valueOf(){return this.value};function provide(name,init){if(!exports[name]){var locker=new Locker(name);exports[name]=init(locker.wrapper(),locker.unwrapper())}}var assemble=function(){var code='return function toString(){ return "'+(Object+"").replace(/\n/g,"\\n").replace("Object",'"+this.name+"')+'" }',toString={configurable:!0,writable:!0,value:Function(code)()},hidden={enumerable:!1};if(Function.__proto__)var fnproto=Object.create(Function.prototype,{toString:toString}),setToString=function setProto(fn){fn.__proto__=fnproto};else var setToString=function setToString(fn){Object.defineProperty(fn,"toString",toString)};function nativeToString(fn){return!hasOwn(fn,"toString")&&fn.toString!==toString.value&&setToString(fn),fn}return function assemble(proto){var brand="[object "+proto.constructor.name+"]";return proto.toString=function toString(){return brand},Object.keys(proto).forEach(function(key){Object.defineProperty(proto,key,hidden),typeof proto[key]=="function"&&nativeToString(proto[key])}),proto.constructor.prototype=proto,proto.constructor}}();provide("WeakMap",function(wrap,unwrap){function validate(key){if(isPrimitive(key))throw new TypeError("WeakMap keys must be objects")}return assemble({constructor:function WeakMap(){if(!(this instanceof WeakMap))return new WeakMap;wrap(this,new Locker)},get:function get(key){return validate(key),unwrap(this).get(key)},set:function set(key,value){return validate(key),unwrap(this).set(key,value)},has:function has(key){return validate(key),unwrap(this).get(key)!==undefined},"delete":function delete_(key){validate(key);var weakmap=unwrap(this);return weakmap.get(key)!==undefined?(weakmap.set(key,undefined),!0):!1}})}),provide("Hashmap",function(wrap,unwrap){function validate(key){if(key){var type=typeof key;if(type==="object"||type==="function"){typeof key.valueOf=="function"&&(key=key.valueOf());if(isObject(key))throw new TypeError("Hashmap keys must have a primitive value")}}return key+""}return assemble({constructor:function Hashmap(){if(!(this instanceof Hashmap))return new Hashmap;wrap(this,keystore())},get:function get(key){return key=validate(key),unwrap(this)[key]},set:function set(key,value){return key=validate(key),unwrap(this)[key]=value},has:function has(key){return key=validate(key),key in unwrap(this)},"delete":function delete_(key){key=validate(key);var hash=unwrap(this);return key in hash?(delete hash[key],!0):!1},keys:function keys(){return Object.keys(unwrap(this))},values:function values(){var hash=unwrap(this);return Object.keys(hash).map(function(key){return hash[key]})},iterate:function iterate(callback,context){var hash=unwrap(this);context=isObject(context)?context:global;for(var k in hash)callback.call(context,hash[k],k)},toArray:function toArray(){var out=[];return this.iterate(function(value,key){out.push(new Pair(key,value))}),out},toObject:function toObject(){var out={};return this.iterate(function(value,key){out[key]=value}),out}})}),provide("Map",function(wrap,unwrap){return assemble({constructor:function Map(){if(!(this instanceof Map))return new Map;wrap(this,{0:new exports.Hashmap,1:new exports.WeakMap,keys:[],values:[]})},get:function get(key){var map=unwrap(this);return map.values[map[+isObject(key)].get(key)]},set:function set(key,value){var map=unwrap(this),table=map[+isObject(key)],index=table.get(key);return index===undefined?(table.set(key,map.keys.length),map.keys.push(key),map.values.push(value)):(map.keys[index]=key,map.values[index]=value),value},has:function has(key){return unwrap(this)[+isObject(key)].has(key)},"delete":function delete_(key){var map=unwrap(this),table=map[+isObject(key)],index=table.get(key);return index===undefined?!1:(table.delete(key),map.keys.splice(index,1),map.values.splice(index,1),!0)},keys:function keys(){return unwrap(this).keys.slice()},values:function values(){return unwrap(this).values.slice()},iterate:function iterate(callback,context){var map=unwrap(this),keys=map.keys,values=map.values;context=isObject(context)?context:global;for(var i=0,len=keys.length;i<len;i++)callback.call(context,values[i],keys[i])},toArray:function toArray(){var out=[];return this.iterate(function(value,key){out.push(new Pair(key,value))}),out}})}),provide("Set",function(wrap,unwrap){return assemble({constructor:function Set(){if(!(this instanceof Set))return new Set;wrap(this,new exports.Map)},add:function add(key){return unwrap(this).set(key,!0)},has:function has(key){return unwrap(this).has(key)},"delete":function delete_(key){return unwrap(this).delete(key)},values:function values(callback,context){return unwrap(this).keys()},iterate:function iterate(callback,context){this.keys().forEach(callback,isObject(context)?context:global)}})})}()}(typeof module=="undefined"?this:module.exports,Function("return this")())